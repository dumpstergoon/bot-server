#!/usr/bin/env node
// @ts-nocheck
'use strict';
console.log('Starting Bot Exchange Network...');

const VIEWS = '../views';
const express = require('express'),
		protocol = 'secure',
		secure = (string => protocol === 'secure' ? string : ''),
		port = process.env.PORT || 3000,
		domain = process.env.DOMAIN || 'skycrate.net';
const express_websockets = require('express-ws')(express());
const app = express_websockets.app;
const zengine = require('../../zengine');
const render = zengine.init({
	directory: VIEWS
}).layout('layout', {
	secure: secure,
	domain: domain,
	port: port,
	http_protocol: `http${ secure('s') }://`,
	socket_protocol: `ws${ secure('s') }://`,
	endpoint: `${ domain }${ secure ? '' : ':' + port }/exchange`,
	uuid: require('../utils').generate_uuid
});

const ben = require('../index');

app.engine('jst', zengine.express(render));
app.set('views', VIEWS);
app.set('view engine', 'jst');

app.use(express.json());
app.use(express.urlencoded({
	extended: true
}));
app.use(
	"/exchange",
	ben.init(express.Router(), express_websockets)
);

app.listen(port, () => {
	console.log(`Bot Exchange Network hosting on port ${port}.`);
	console.log(process.env);
});
