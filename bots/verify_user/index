#!/usr/bin/env node
// @ts-nocheck
'use strict';

const {
	action,
	bot,
	bootstrap
} = require("../../component");

const nlp = require('../../nlp');

const {
	user,
	info
} = require('../../models');

const component = bot(
	require("./responses.json"),
	{
		// Entry point:
		index: action.default("confirm"),
		// We're looking for a yes or no here... depending on the answer,
		// we "route" to the appropriate action:
		confirm: action.confirm(
			"email",
			"verify_cancelled",
			"not_understood"
		),
		// Call upon our "email" component:
		email: action.bot('email', (response, state, send, route, pass) => {
			console.log('VERIFY USER COMPONENT', state.context);
			pass('verify_passphrase', response);
		}),
		// Say we don't understand and then go back to confirm:
		not_understood: action.default("confirm"),
		// Exit the component:
		verify_cancelled: action.exit(),

		verify_passphrase: action.bot('verify_passphrase', (response, state, send, route, pass) => {
			// Add a fake user:
			state.context.user = user(
				'Graham',
				'Robertson',
				'Mr.'
			);
			state.context.userInfo = info(
				state.context.userInfo.email,
				new Date('1988-09-14'),
				'brogrammer',
				'Software Guru',
				'Nice enough.'
			);
			pass('exit', response);
		}),

		exit: action.exit()
	});

// Hooks our bot into the appropriate IO:
bootstrap(component);
